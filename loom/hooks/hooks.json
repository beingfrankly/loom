{
  "description": "Loom plugin hooks with XML-structured guardrails and command-based enforcement for multi-agent workflow",
  "hooks": {
    "SessionStart": [],
    "PreToolUse": [
      {
        "matcher": "Write",
        "hooks": [
          {
            "type": "command",
            "command": "node ${CLAUDE_PLUGIN_ROOT}/hooks/scripts/pre-tool-use/validate-write.js",
            "timeout": 5000
          }
        ]
      },
      {
        "matcher": "Task",
        "hooks": [
          {
            "type": "prompt",
            "prompt": "<delegation-guidance>\n\n## Plan Mode Detection (CRITICAL)\n\nBefore attempting to spawn any loom:* agent, CHECK if you are in plan mode.\n\nPlan mode indicators:\n- System message mentions \"plan mode is active\"\n- Instructions say \"read-only except plan file\"\n- You're in Phase 1-4 of planning workflow\n\n### If in Plan Mode:\n\nDO NOT attempt to spawn loom:explorer (it will fail).\n\nInstead, use AskUserQuestion FIRST:\n```json\n{\n  \"questions\": [{\n    \"question\": \"loom:explorer requires edit mode. How would you like to proceed?\",\n    \"header\": \"Mode\",\n    \"options\": [\n      {\"label\": \"Use built-in Explore\", \"description\": \"Use Claude Code's Explore agent (allowed in plan mode)\"},\n      {\"label\": \"Switch to edit mode\", \"description\": \"I'll run /edit, then you can use loom:explorer\"},\n      {\"label\": \"Cancel\", \"description\": \"Skip exploration and continue with current context\"}\n    ],\n    \"multiSelect\": false\n  }]\n}\n```\n\n### If in Edit Mode:\n\nProceed normally with loom:explorer.\n\n## Available Loom Agents (Edit Mode Only)\n\n- loom:planner - Creates implementation plans from context.md\n- loom:code-reviewer - Reviews plans and implementations\n- loom:implementer - Executes individual tasks\n- loom:explorer - Fast codebase reconnaissance (Haiku model)\n\n## Available in Plan Mode\n\n- Built-in Explore agent (subagent_type=\"Explore\")\n- Built-in Plan agent (subagent_type=\"Plan\")\n\n</delegation-guidance>"
          }
        ]
      }
    ],
    "PostToolUse": [],
    "Stop": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "<session-end>\n<reminder>If there is an active loom session, consider checking task status with /loom-status before ending.</reminder>\n</session-end>"
          }
        ]
      }
    ]
  }
}
